/*!build time : 2013-12-06 7:43:46 PM*/
KISSY.add("gallery/addBookmark/1.0/index",function(a,b,c,d,e){function f(b){if(!(this instanceof f))return new f(b);var c=a.merge(j,b);return g(c.container)?(this.popup=null,this.isShow=!1,f.superclass.constructor.call(this,b),this._init(c),void 0):(a.log("container not exit"),void 0)}var g=c.all,h="macintosh",i="overlay",j={container:g("body"),showTip:!0,tipType:i,bookmarkTitle:document.title,text:"\u6536\u85cf",cls:"ks-add-bookmark",successText:"\u52a0\u5165\u4e66\u7b7e\u6210\u529f",hasAddedText:"\u5df2\u7ecf\u52a0\u5165\u6807\u7b7e\u4e86",mobileTipText:"\u8bf7\u4f7f\u7528\u52a0\u5165\u4e66\u7b7e\u529f\u80fd\u6536\u85cf\u672c\u9875:)",windowsTipText:"\u8bf7\u6309\u4e0bctrl+d\u952e\u5c06\u672c\u9875\u52a0\u5165\u4e66\u7b7e",macTipText:"\u8bf7\u6309\u4e0bcommand+d\u952e\u5c06\u672c\u9875\u52a0\u5165\u4e66\u7b7e",operaTiptext:"\u8bf7\u70b9\u51fb\u5730\u5740\u680f\u53f3\u4fa7\u7684\u5fc3\u5f62\u6dfb\u52a0\u5230\u85cf\u5b9d\u7bb1",popupCls:"ks-add-bookmark-popup",popupWidth:300,popupHeight:34,popupAlignNode:null,popupPoints:["bl","tl"],duration:4e3},k='<a href="javascript:;" class="{cls}">{text}</a>';return a.extend(f,b,{_init:function(a){this._render(a),this._bindEvent(a)},_render:function(b){var c=a.substitute(k,b);a.ready(function(){g(b.container).prepend(c)})},_bindEvent:function(b){var c=this;g(b.container).delegate("click","."+b.cls,function(d){if(d.preventDefault(),c.isShow)return a.log("overlay exits;"),void 0;var e=g(d.currentTarget),f=document.title,h=window.location.href;if(c.get("hasAdded"))return b.showTip&&c._tip(e,b,b.hasAddedText),void 0;try{window.external.addFavorite(h,f),b.showTip&&c._tip(e,b,b.successText),c.set("hasAdded",!0),c.fire("addBookmarkSuccess",{cfg:b})}catch(d){try{window.sidebar.addPanel(f,h,""),b.showTip&&c._tip(e,b,b.successText),c.set("hasAdded",!0),c.fire("addBookmarkSuccess",{cfg:b})}catch(d){b.showTip&&c._tip(e,b),c.fire("addBookmarkFailure",{cfg:b})}}})},_tip:function(a,b,c){c=c||this._getTipText(b),b.tipType===i?this._overlay(a,b,c):this._alert(c)},_overlay:function(b,c,d){var f=this;f.isShow=!0;var g="body"===c.popupAlignNode?{points:["cc","cc"]}:{node:b,points:c.popupPoints};f.popup?f.popup.set("content",d):(f.popup=new e({elCls:c.popupCls,content:d,triggerType:"click",width:c.popupWidth,height:c.popupHeight,align:g,zIndex:1e4}),f.popup.render()),f.popup.show(),a.later(function(){f.popup&&f.popup.hide(),f.isShow=!1},c.duration)},_alert:function(a){alert(a)},_getTipText:function(a){var b="";return b=d.mobile?a.mobileTipText:d.os===h?a.macTipText:d.opera?a.operaTiptext:a.windowsTipText}},{ATTRS:{hasAdded:!1}}),f},{requires:["base","node","ua","overlay","./index.css"]});